<!DOCTYPE html>
<html>
<head>
    <title>Sophia Chat</title>
</head>
<body>
    <h1 id="title">Sophia Chat</h1>
    <div id="chat-box" style="height: 300px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px;"></div>
    <input type="text" id="message-input" placeholder="Type your message..." style="width: 80%;"/>
    <button onclick="sendMessage()">Send</button>
    <script>
        const chatBox = document.getElementById("chat-box");
        const messageInput = document.getElementById("message-input");
        const sessionId = "session_" + Math.random().toString(36).substr(2, 9);

        // Assign ws to window so playwright can access it
        window.ws = new WebSocket(`ws://127.0.0.1:8000/ws/${sessionId}`);

        window.ws.onmessage = function(event) {
            const message = document.createElement("p");
            message.textContent = "Sophia: " + event.data;
            chatBox.appendChild(message);
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        function sendMessage() {
            const message = messageInput.value;
            if (message) {
                window.ws.send(message);
                const userMessage = document.createElement("p");
                userMessage.textContent = "You: " + message;
                chatBox.appendChild(userMessage);
                messageInput.value = "";
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        messageInput.addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>
</html>
